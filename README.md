https://github.com/Le0har/weblarek

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.
View - слой представления, отвечает за отображение данных на странице.
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:
`baseUrl: string` - базовый адрес сервера
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### Интерфейс IProduct (Товар)
Содержит информацию о товаре интернет-магазина.

```
interface IProduct {
  id: string;    // Уникальный идентификатор товара
  description: string;    // Подробное описание товара
  image: string;    // Ссылка на изображение товара
  title: string;    // Название товара
  category: string;    // Категория товара
  price: number | null;    // Цена товара
}
```

#### Интерфейс IBuyer (Покупатель)
Содержит информацию о покупателе, желающем приобрести товар.

```
interface IBuyer {
  payment: TPayment;    // Способ оплаты заказа
  email: string;    // Электронная почта для связи с покупателем
  phone: string;    // Номер телефона для связи с покупателем
  address: string;    // Адрес доставки заказа
}
```

#### Тип TPayment
Выбор способа оплаты покупателем.

```
type TPayment = 'card' | 'cash' | '';
```

#### Интерфейс IApi
Определяет контракт о методах GET и POST (обязательны для реализации).

```
interface IApi {
  get<T extends object>(uri: string): Promise<T>;
  post<T extends object>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

#### Интерфейс IProductListResponse
Формат ответа сервера на запрос получения списка товаров.

```
interface IProductListResponse {
  total: number;    // Общее количество товаров
  items: IProduct[];    // Список товаров
}
```

#### Интерфейс IOrderRequest
Формат запроса на сервер для формирования заказа.

```
interface IOrderRequest extends IBuyer {
  total: number;    // Общая стоимость заказа
  items: IProduct['id'][];    // Список идентификаторов товаров в заказе
}
```

#### Интерфейс IOrderResponse
Формат ответа сервера на запрос создания заказа.

```
interface IOrderResponse {
  id: string;    // Идентификатор созданного заказа
  total: number;    // Общая стоимость заказа
}
```

#### Тип ApiPostMethods
Доступные HTTP-методы для запросов.

```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'
```

#### Интерфейс IHeader
Данные, необходимые для отображения шапки сайта.

```
interface IHeader {
  counter: number;    // количество товаров в корзине для отображения в счетчике
}
```

#### Интерфейс IGallery
Данные, необходимые для отображения списка карточек товара.

```
interface IGallery {
  catalog: HTMLElement[];    // список карточек товаров
}
```

#### Интерфейс IModal
Данные, необходимые для отображения контента модального окна.

```
interface IModal {
  content: HTMLElement;    // контент модального окна
}
```

#### Интерфейс ISuccess
Данные, необходимые для отображения текста с количеством списанных средств.

```
interface ISuccess {
  description: string;    // текст с количеством списанных средств
}
```

#### Интерфейс IBasket
Данные, необходимые для отображения списка товаров и общей стоимости в корзине.

```
interface IBasket {
  list: HTMLElement[];    // список товаров в корзине
  price: number | null;    // общая стоимость товаров в корзине
  valid: boolean;    // блокирует/разблокирует кнопку "Оформить" в корзине
}
```

#### Интерфейс ICard
Базовый интерфейс карточки товара. Данные, необходимые для отображения элементов карточки товара.

```
interface ICard {
  title: string;    // название товара
  pprice: number | null;    // стоимость товара
}
```

#### Интерфейс ICardCatalog наследуюется от ICard
Интерфейс карточки товара в списке товаров(каталоге). Данные, необходимые для отображения элементов карточки товара.

```
interface ICardCatalog extends ICard {
  category: string;    // категория товара
  image: string;    // изображение товара
}
```

#### Интерфейс ICardBasket наследуюется от ICard
Интерфейс карточки товара в списке товаров(корзине). Данные, необходимые для отображения элементов карточки товара.

```
interface ICardBasket extends ICard {
  index: number;    // порядковый номер товара в корзине
}
```

#### Интерфейс ICardPreview наследуюется от ICard
Интерфейс карточки товара в модальном окне. Данные, необходимые для отображения элементов карточки товара.

```
interface ICardPreview extends ICard {
  category: string;    // категория товара
  image: string;    // изображение товара
  text: string;    // описание товара
  inCart: boolean;    // проверяет наличие товара в корзине
}
```

#### Интерфейс IForm
Базовый интерфейс формы. Данные, необходимые для проверки формы.
```
interface IForm {
  errors: string;    // ошибки формы
  valid: boolean;    // валидация формы
}
```

#### Интерфейс IFromOrder наследуюется от IForm
Данные, необходимые для оформления заказа.
```
interface IFromOrder extends IForm {
  payment: TPayment;    // способ оплаты
  address: string;    // адрес доставки
}
```

#### Интерфейс IFormContact наследуюется от IForm
Данные, необходимые для оформления заказа. Контакты покупателя.
```
interface IFormContact extends IForm {
  email: string;    // электроная почта
  phone: string;    // телефон
}
```

### Модели данных

#### Класс Products
Хранение товаров, которые можно купить в приложении.

Конструктор:
`constructor()` - не принимает параметров.

Поля класса:
`items: IProduct[]` - хранит массив всех товаров.
`selectedItem: IProduct`- хранит товар, выбранный для подробного отображения.

Методы класса:
`setItems(items: IProduct[]): void` - сохранение массива товаров полученного в параметрах метода.
`getItems(): IProduct[]` - получение массива товаров из модели.
`getItemById(id: string): IProduct` - получение одного товара по его id.
`setSelectedItem(item: IProduct): void` - сохранение товара для подробного отображения.
`getSelectedItem(): IProduct` - получение товара для подробного отображения.

#### Класс Cart
Хранение товаров, которые пользователь выбрал для покупки.

Конструктор:
`constructor()` - не принимает параметров.

Поля класса:
`items: IProduct[]` - хранит массив товаров, выбранных покупателем для покупки.

Методы класса:
`getItems(): IProduct[]` - получение массива товаров, которые находятся в корзине.
`addItem(item: IProduct): void` - добавление товара, который был получен в параметре, в массив корзины.
`removeItem(item: IProduct): void` - удаление товара, полученного в параметре из массива корзины.
`clear(): void` - очистка корзины.
`getTotalPrice(): number` - получение стоимости всех товаров в корзине.
`getItemsCount(): number` - получение количества товаров в корзине.
`hasItem(id: string): boolean` - проверка наличия товара в корзине по его id, полученного в параметр метода.

#### Класс Buyer
Данные покупателя, которые тот должен указать при оформлении заказа.

Конструктор:
`constructor()` - не принимает параметров.

Поля класса:
`payment: TPayment`- вид оплаты покупателем.
`email: string`- email покупателя.
`phone: string`- телефон покупателя.
`address: string`- адрес покупателя.

Методы класса:
`setPayment(payment: TPayment): void` - сохранение вида оплаты покупетелем.
`setEmail(email: string): void` - сохранение email покупателя.
`setPhone(phone: string): void`- сохранение телефона покупателя.
`setAddress(address: string): void` - сохранение адреса покупателя.
`getData(): IBuyer` - получение всех данных покупателя.
`clear(): void` - очистка данных покупателя.
`validate(): { payment?: string; email?: string; phone?: string; address?: string }` - валидация данных.

### Слой коммуникации

#### Класс WebLarekApi
Класс для взаимодействования с API сервера «веб-ларёк».
Отвечает за получение данных с сервера и отправку данных на сервер.

Конструктор:
`constructor(api: IApi)` - принимает объект (экземпляр класса), который реализует методы GET и POST по контракту IApi.

Поля класса:
`api: IApi`- хранит объект для работы с API, реализующий интерфейс IApi.

Методы класса:
`getProductList(): Promise<IProductListResponse>` - получает с сервера список товаров.
`createOrder(data: IOrderRequest): Promise<IOrderResponse>` - отправляет на сервер данные о покупателе и выбранных товарах.

### Слой представлений

#### Класс Header наследуется от класса Component<IHeader>
Отвечает за отображение корзины и счетчика количества товаров в шапке сайта.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`counterElement: HTMLElement` - счетчик количества товаров в корзине.
`headerBasketButton: HTMLButtonElement` - кнопка для открытия корзины.
`events: IEvents` - брокер событий для коммуникации с презентером.

Методы класса:
`set counter(counter: number)` - установить количество товаров в корзине.

#### Класс Gallery наследуется от класса Component<IGallery>
Отвечает за отображение списка карточек товаров.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент.

Методы класса:
`set catalog(items: HTMLElement[])` - установить список карточек товаров.

#### Класс Modal наследуется от класса Component<IModal>
Отвечает за отображение самого модального окна.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`contentElement: HTMLElement` - контент модального окна.
`modalButton: HTMLButtonElement` - кнопка для закрытия окна.
`events: IEvents` - брокер событий для коммуникации с презентером.

Методы класса:
`set content(content: HTMLElement)` - установить контент для модального окна.
`open(): void` - открыть модальное окно.
`lose(): void` - закрыть модальное окно.
`isOpen(): void` - открыто ли сейчас модальное окно.

#### Класс Success наследуется от класса Component<ISuccess>
Отвечает за отображение успешного оформления заказа в модальном окне.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`descriptionElement: HTMLElement` - описание количества списанных средств после оформленя заказа.
`successButton: HTMLButtonElement` - кнопка для закрытия окна.
`events: IEvents` - брокер событий для коммуникации с презентером.

Методы класса:
`set description(description: string)` - установить текст с количеством списанных средств.

#### Класс Basket наследуется от класса Component<IBasket>
Отвечает за отображение корзины в модальном окне.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`listElement: HTMLElement` - список товаров в корзине.
`priceElement: HTMLElement` - общая стоимость товаров в корзине.
`basketButton: HTMLButtonElement`- кнопка для оформления заказа.
`events: IEvents` - брокер событий для коммуникации с презентером.

Методы класса:
`set list(list: HTMLElement[])` - установить список товаров.
`set price(price: number | null)` - установить текст с общей стоимостью товаров в корзине.
`set valid(isValid: boolean)` - блокирует/разблокирует кнопку "Оформить" в корзине.

#### Класс Card наследуется от класса Component<ICard>
Базовый класс, отвечающий за отображение карточки товара.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент.

Поля класса:
`titleElement: HTMLElement` - название товара.
`priceElement: HTMLElement` - стоимость товара.

Методы класса:
`set title(title: string)` - установить название товара.
`set price(price: number | null)` - установить стоимость товара.

#### Класс CardCatalog наследуется от класса Card
Наследуются от базового класса Card. Отвечает за отображение карточки товара в списке товаров(каталоге).

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`categoryElement: HTMLElement` - категория товара.
`imageElement: HTMLImageElement` - изображение товара.
`cardCatalogButton: HTMLButtonElement` - кнопка для открытия модального окна с подробным описанием товара.

Методы класса:
`set category(category: string)` - установить категорию товара.
`set image(src: string)` - установить изображение товара.

#### Класс CardBasket наследуется от класса Card
Наследуются от базового класса Card. Отвечает за отображение карточки товара в списке товаров(корзине).

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`indexElement: HTMLElement` - порядковый номер в корзине.
`cardBasketButton: HTMLButtonElement` - кнопка для удаления товара из корзины.

Методы класса:
`set index(index: number)` - установить порядковый номер товара в корзине.

#### Класс CardPreview наследуется от класса Card
Наследуются от базового класса Card. Отвечает за подробное отображение карточки товара в модальном окне.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`categoryElement: HTMLElement` - категория товара.
`textElement: HTMLElement` - описание товара.
`imageElement: HTMLImageElement` - изображение товара.
`cardPreviewButton: HTMLButtonElement` - кнопка для перемещения товара в корзину.

Методы класса:
`set category(category: string)` - установить категорию товара.
`set text(text: string)` - установить описание товара.
`set image(src: string)` - установить изображение товара.
`set inCart(isInCart: boolean)` - меняет название кнопки "Удалить из корзины" / "В корзину".

#### Класс Form наследуется от класса Component<ICard>
Базовый класс, отвечающий за заполнение формы покупателем.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент.

Поля класса:
`errorsElement: HTMLElement` - ошибки формы.
`submitButton: HTMLButtonElement` - кнопка принятия формы.

Методы класса:
`set errors(errors: string)` - ошибки формы.
`set valid(value: boolean)` - валидация формы делает активной/некативной кнопку принятия формы.

#### Класс FormOrder наследуется от класса Form
Наследуются от базового класса Form. Отвечает за заполнение формы для заказа покупателем.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`orderCardButton: HTMLButtonElement` - кнопка для выбора типа оплаты "Онлайн"(card).
`orderCashButton: HTMLButtonElement` - кнопка для выбора типа оплаты "При получении"(cash).
`addressInputEelement: HTMLInputElement` - поле для ввода адреса доставки.

Методы класса:
`set address(address: string)` - установить адрес доставки.
`set payment(value: TPayment)` - делает активной/некативной одну из кнопок способа оплаты заказа.

#### Класс FormContact наследуется от класса Form
Наследуются от базового класса Form. Отвечает за заполнение формы для контактов покупятеля.

Конструктор:
`constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на DOM элемент и брокер событий.

Поля класса:
`emailInputElement: HTMLInputElement` - поле для ввода электронной почты.
`phoneInputElement: HTMLInputElement` - поле для ввода телефона.

Методы класса:
`set email(email: string)` - установить электронную почту.
`set phone(phone: string)` - установить телефон.

### Слой события приложения

#### События View → Presenter

##### Карточка товара (CardCatalog):

`card:selected` - клик по карточке в каталоге

##### Предпросмотр товара (CardPreview):

`card:add` - добавление товара в корзину (кнопка "В корзину")

`card:remove` - удаление товара из корзины (кнопка "Удалить из корзины")

##### Корзина (Basket):

`basket:open` - открытие корзины (клик на иконку в шапке)

`basket:place` - оформление заказа (кнопка "Оформить")

`cardBasket:delete` - удаление товара из корзины (кнопка удаления)

##### Форма заказа (FormOrder):

`order:card` - выбор оплаты "Онлайн"

`order:cash` - выбор оплаты "При получении"

`order:address` - изменение поля адреса

`order:submit` - отправка формы заказа (кнопка "Далее")

##### Форма контактов (FormContact):

`contact:email` - изменение поля email

`contact:phone` - изменение поля телефона

`contact:submit` - отправка формы контактов (кнопка "Оплатить")

##### Модальное окно (Modal):

`modal:close` - закрытие модального окна (клик на крестик или фон)

##### Успешное оформление (Success):

`success:close` - закрытие окна успешного оформления

#### События Model → Presenter

##### Товары (Products):

`products:changed` - изменился список товаров

##### Корзина (Cart):

`cart:changed` - изменилось содержимое корзины

##### Покупатель (Buyer):

`buyer:changed` - изменились данные покупателя

### Слой Презентер

#### Структура:

- Реализован в едином файле main.ts
- Состоит из коллекции обработчиков событий (events.on())
- Не является классом - это набор функций-обработчиков

#### Основные обязанности:

- Инициализация приложения
- Обработка действий пользователя
- Управление состоянием корзины
- Валидация форм
- Оформление заказа